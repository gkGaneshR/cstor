language: c
sudo: required
env:
  global:
    # Travis limits maximum log size, we have to cut tests output 
    - CODECOV_TOKEN="987cf0f1-ae3b-477e-b645-954e682f99ec"
    - ZFS_TEST_TRAVIS_LOG_MAX_LENGTH=800

#matrix:
    
before_install:
    make prerequisites

install:
    make cstor-base-image

#before_script:
#    - make cstyle;

#script:

after_failure:
    - find /var/tmp/test_results/current/log -type f -name '*' -printf "%f\n" -exec cut -c -$ZFS_TEST_TRAVIS_LOG_MAX_LENGTH {} \;
after_success:
    - find /var/tmp/test_results/current/log -type f -name '*' -printf "%f\n" -exec cut -c -$ZFS_TEST_TRAVIS_LOG_MAX_LENGTH {} \;
    - bash <(curl -s https://codecov.io/bash)
